<div class="section flex flex-wrap gap-2">
    <a class="link font-medium leading-normal" title="Edit" [routerLink]="['/edit']">Edit</a>
    <span class="text-accent font-medium leading-normal">/</span>
    <span>{{user() ? user()!.name : 'New User'}}</span>
</div>

<h2 class="title flex justify-between items-start gap-2">
    Edit User

    <div class="flex gap-2">
        @if(user() != null) {
        <button type="button" class="button button-accent shrink-0 flex gap-2" title="Forgot password"
            (click)="forgotPassword()">
            <fa-icon [icon]="faQuestion" />
            <span class="hidden lg:inline">Forgot password</span>
        </button>
        <button type="button" class="button button-accent shrink-0 flex gap-2" title="Delete" (click)="delete()">
            <fa-icon [icon]="faTrash" />
            <span class="hidden lg:inline">Delete</span>
        </button>
        }
    </div>
</h2>


<form [formGroup]="form" (ngSubmit)="onSubmit()" class="section flex flex-col gap-4">

    <div>
        <label class="label" for="id">Id</label>
        <input type="text" formControlName="id" id="id" class="input w-full" />
    </div>

    <div>
        <label class="label" for="new-password">New password</label>
        <input type="password" formControlName="newPassword" id="new-password" class="input w-full"
            placeholder="Password123$" />
    </div>

    <div>
        <label class="label" for="email">Email</label>
        <input type="email" formControlName="email" id="email" class="input w-full" placeholder="Mario@mail.com" />
    </div>

    <div>
        <label class="label" for="email-confirmed">Email confirmed</label>
        <input type="checkbox" formControlName="emailConfirmed" id="email-confirmed" class="input-checkbox" />
    </div>

    <div>
        <label class="label" for="name">Name</label>
        <input type="text" formControlName="name" id="name" class="input w-full" placeholder="Mario" />
    </div>

    <div>
        <button type="submit" class="button button-primary" title="Save"
            [disabled]="!form.valid || isLoading()">Save</button>
    </div>
</form>


@if (user()?.id) {
<div class="section">
    <h3 class="title2">Roles</h3>

    <div class="section overflow-auto">
        <table class="table w-full overflow-auto break-normal">
            <thead>
                <tr>
                    <th>id</th>
                    <th>name</th>
                </tr>
            </thead>
            <tbody>
                @for (role of user()!.roles; track $index) {
                <tr>
                    <td>{{role.id}}</td>
                    <td>{{role.name}}</td>

                    <td>
                        <button type="button" class="icon-button" title="Remove Role"
                            (click)="removeRole(role.id)"><fa-icon [icon]="faTrash" /></button>
                    </td>
                </tr>
                }
                <tr>
                    <td colspan="100%">
                        <button type="button" class="button button-accent" title="Add Role" (click)="addRole()">Add
                            Role</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="section">
    <h3 class="title2">Token Infos</h3>

    <div class="section overflow-auto">
        <table class="table w-full overflow-auto break-normal">
            <thead>
                <tr>
                    <th>id</th>
                    <th>user name</th>
                    <th>refresh token</th>
                    <th>expired at</th>
                    <th>refreshed at</th>
                    <th>device id</th>
                </tr>
            </thead>
            <tbody>
                @for (tokenInfo of user()!.tokenInfos; track $index) {
                <tr>
                    <td>{{tokenInfo.id}}</td>
                    <td>{{tokenInfo.userName}}</td>
                    <td>{{tokenInfo.refreshToken}}</td>
                    <td>{{tokenInfo.expiredAt | date:'long'}}</td>
                    <td>{{tokenInfo.refreshedAt | date:'long'}}</td>
                    <td>{{tokenInfo.deviceId}}</td>
                </tr>
                }
            </tbody>
        </table>
    </div>
</div>
}